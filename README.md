# SunnyChain
Sunny Accounting base on Blockchain for NGOs

区块链化NGO财务系统 阳光链


引言

公信力是公益组织的生命线，NGO的运作应该遵循公开、透明、规范的原则。其中，财务信息的公开至关重要。公开财务信息，让外界了解资金的使用状况,可以提高NGO的可信度,保障NGO的公信力。
区块链是一种按照时间顺序将数据区块按次序相连的方式，将数据组合起来的链式数据结构，并以密码学方式保证不可篡改和不可伪造的分布式账本。区块链具备去中心化、自治、不可篡改、公开、高度透明等特征。
区块链信息不可篡改，一旦信息经过验证并添加至区块链，就会被永久地存储起来，数据稳定性和可靠性极高。区块链去中心化和自治的特征，更加保障了其公信力。区块链的数据对所有人公开，任何人都可以通过公开的接口查询区块链数据，因此整个系统信息高度透明。区块链采用公开透明的算法，排斥人为干预，极大地提高了其信任度。区块链可以帮助NGO实现更加真实、透明、可靠、可信的财务运作，帮助NGO提高公信力。
阳光链是一个将区块链技术运用到NGO的财务管理之中的具体技术方案，以帮助NGO将财务管理区块链化。阳光链的核心思想是在现有财务系统的基础上，增加若干模块，运用区块链智能合约来记录NGO的基础会计数据。


系统基本架构

实现区块链化的财务系统，关键在于将每一个基础会计数据（通常指全部的会计分录）写入到区块链中，把区块链作为会计基础会计数据的存储媒介，而不是像传统系统那样，把会计数据全部存储到内部的数据库中。
由于财务系统的所产生的会计账簿、财务报表数据，均来源于对基础会计数据的加工和运算，因此，只要保证所有的基础会计数据都存储在区块链上，即可保证所有财务数据的公开透明。
由于目前流行的区块链系统，均不适合存储大数据量的数据（另外，还要考虑到交易费用与数据量成正比的问题），因此，不考虑把会计账簿、财务报表等非基础会计数据存储在区块链上。这也从侧面反映了目前区块链应用的一个缺陷——难以将所有的应用数据都存储在区块链上，因为链上存储数据的代价太高，所以，我们采取了一个部分去中心化的方案，保证关键数据的去中心化，而非关键数据仍采用中心化的数据库存储。


基础会计数据的区块链存储

可以将基础会计数据存储在智能合约中。为了便于讨论，以以太坊为例，使用其智能合约来记录会计分录。下面为使用Solidity语言，举例定义一个存储基础会计数据的合约代码：

contract NgoAccounting {

  // 机构名称
  string public NgoName;

  // 三个账务角色的地址：分别为CEO、CFO、会计
  address public ceoAddress;
  address public cfoAddress;
  address public accAddress;

  // 科目信息，存储科目名称及余额
  struct StructAccount {
	  string name;
	  int256 balance;
  }

  // 科目编码到科目信息的映射（科目编码最大长度为32位）
  mapping (uint32 => StructAccount) public accounts;

  // 会计分录结构
  struct Entry {
    uint32 account;
    int256 amount; // 用整数加小数点位数的方式来表示小数金额
    ……
  }

  // 初始化合约，设置NGO的名称
  function NgoAccounting(
      string _NgoName
      ) public {
      NgoName = _NgoName;              // 设置机构名称
	  ……
  }

  // 设置CEO
  function SetCEO(address _address) public {……}
  // 设置CFO
  function SetCFO(address _address) public {……}
  // 设置会计
  function SetAccountant(address _address) public {……}
  // 新增会计科目
  function AddAccount(uint32 _accountNum, string _accountName) public {……}
  // 新增凭证（每张会计凭证有2个以上的会计分录）
  function AddEntries(Entry[] _entries, ……) public {……}
  ……
}
上述代码只是提供一个最简要的示例，做一个原理性的说明。
合约主要存储会计科目（accounts），每个科目包括科目代码、科目名称和科目余额（金额）。AddEntries()函数执行写入会计分录的操作，这个函数是所有基础会计数据的写入接口。通过对这个函数参数的提取，可以获取所有的会计分录数据。


会计业务录入

在财务系统中，需要有一个新的会计业务录入模块。传统模式下，会计业务录入后直接存入财务系统内的数据库，会计业务录入模块将通过区块链写入功能，把会计分录写入到区块链中。


区块链写入

区块链写入功能，将会计分录写入区块链。写入区块链的方法可以是调用已部署的智能合约，如前文示例中合约的AddEntries()函数。


同步更新

为了保证财务系统的性能，不应该在每次生成会计账簿、财务报表时再从区块链读取会计分录数据。因此，设计一个同步更新模块，不断检查区块链中的合约调用情况，如果发现区块链中存在新的已确认的会计分录，则把这些分录提取出来并写入财务系统数据库中。
（附注：会计系统中所存储的每个会计分录数据，应保存一个其对应区块的索引或编号，以标明其在区块链中的出处，方便快速反向效验其真实性。）


权限及其它

对于账务数据的写入操作，必须进行权限限制。可以定义CEO/CFO/会计等角色，在执行合约操作时检验操作者的权限，以防止越权操作（会计业务录入模块需要在用户界面上具备对应功能）。
除了将区块链技术运用于财务管理，NGO还可以将其运用在自身的治理上，包括选举、提案的提名、表决或投票。关于区块链在财务管理之外NGO治理上的应用，不在财务管理的范畴之内，我们将另行讨论。
